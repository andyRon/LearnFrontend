浏览器工作原理与实践
---

https://time.geekbang.org/column/intro/100033601

2019 

![](images/image-20231120231649416.png)

标准的制定者和开发者没有达成共识

![](images/image-20231120231928126.png)

浏览器背后是标准，标准背后是==共识==。

![](images/image-20231120232149219.png)

PC端，浏览器越来越重要



移动设备，依然混战

![](images/image-20231120232425895.png)



![](images/image-20231120232518920.png)



![](images/image-20231120232609681.png)



通过学习浏览器搭建自己的知识体系

![](images/image-20231120232839236.png)



![](images/image-20231120233008963.png)

![](images/image-20231120233048657.png)

![](images/image-20231120233116022.png)

![](images/image-20231120233129278.png)



浏览器对网络内容的态度，就是默认不行人  `网络内容  =  不安全`

![](images/image-20231120233329280.png)

![](images/image-20231120233409519.png)





## 一、宏观视角下的浏览器

### 1-Chrome架构：仅仅打开了1个页面，为什么有4个进程？



### 2-TCP协议：如何保证页面文件能被完整送达浏览器？

在衡量Web页面性能的时候有一个重要的指标叫“FP（First Paint）”，是指从页面加载到首次开始绘制的时长。

#### 一个数据包的“旅程”

##### 1 IP：把数据包送达目的主机

![简化的IP网络三层传输模型](images/image-20240319225055979.png)

##### 2 UDP：把数据包送达应用程序



简化的 UDP 网络四层传输模型:

![](images/3edb673a43f23d84253c52124ce447ea.png)

##### 3 TCP：把数据完整地送达应用程序



简化的 TCP 网络四层传输模型

![](images/943ac29f7d5b45a8861b0cde5da99032.png)



#### 总结

- 互联网中的数据是通过数据包来传输的，数据包在传输过程中容易丢失或出错。

- IP 负责把数据包送达目的主机。
- UDP 负责把数据包送达具体应用。
- 而 TCP 保证了数据完整地传输，它的连接可分为三个阶段：建立连接、传输数据和断开连接。

其实了解 TCP 协议，是为了全方位了解 HTTP，包括其实际功能和局限性，之后才会更加深刻地理解为什么要推出 HTTP/2，以及为什么要推出 QUIC 协议，也就是未来的 HTTP/3。这是一个由浅入深、循序渐进的过程，我希望你能稳扎稳打，学好这每一步、每一个协议，后面“水到自然渠成”。

### 3-HTTP请求流程：为什么很多站点第二次打开速度会很快？



#### 浏览器端发起HTTP请求流程



#### 服务器端处理HTTP请求流程





#### 总结

![](images/image-20240319225706046.png)





### 4-导航流程：从输入URL到页面展示，这中间发生了什么？

![img](images/92d73c75308e50d5c06ad44612bcb45d.png)



#### 1 用户输入



#### 2 URL 请求过程

##### 重定向



##### 响应数据类型处理



#### 3 准备渲染进程



#### 4 提交文档



#### 5 渲染阶段







### 5-渲染流程（上）：HTML、CSS和JavaScript，是如何变成页面的？

![](images/image-20240319230313366.png)



#### 构建DOM树

![](images/image-20240319230420487.png)



#### 样式计算（Recalculate Style）

HTML加载CSS的三种方式：

![](images/image-20240319230504448.png)



#### 布局阶段





### 6-渲染流程（下）：HTML、CSS和JavaScript，是如何变成页面的？

#### 分层



#### 图层绘制



#### 栅格化（raster）操作



#### 合成和显示



#### 渲染流水线大总结

从HTML到DOM、样式计算、布局、图层、绘制、光栅化、合成和显示，完整的渲染流水线图：
![](images/image-20240319231514916.png)

1.  渲染进程将HTML内容转换为能够读懂的DOM树结构。
2.  渲染引擎将CSS样式表转化为浏览器可以理解的styleSheets，计算出DOM节点的样式。
3.  创建布局树，并计算元素的布局信息。
4.  对布局树进行分层，并生成分层树。
5.  为每个图层生成绘制列表，并将其提交到合成线程。
6.  合成线程将图层分成图块，并在光栅化线程池中将图块转换成位图。

7.  合成线程发送绘制图块命令DrawQuad给浏览器进程。
8.  浏览器进程根据DrawQuad消息生成页面，并显示到显示器上。





## 二、浏览器中的JavaScript执行机制

### 7-变量提升：JavaScript代码是按顺序执行的吗？



### 8-调用栈：为什么JavaScript代码会出现栈溢出？



### 9-块级作用域：var缺陷以及为什么要引入let和const？



### 10-作用域链和闭包 ：代码中出现相同的变量，JavaScript引擎是如何选择的？



### 11-this：从JavaScript执行上下文的视角讲清楚this





## 三、V8工作原理

### 12-栈空间和堆空间：数据是如何存储的？



### 13-垃圾回收：垃圾数据是如何自动回收的？



### 14-编译器和解释器：V8是如何执行一段JavaScript代码的？



## 四、浏览器中的页面循环系统

### 15-消息队列和事件循环：页面是怎么“活”起来的？



### 16-WebAPI：setTimeout是如何实现的？



### 17-WebAPI：XMLHttpRequest是怎么实现的？



### 18-宏任务和微任务：不是所有任务都是一个待遇



### 19-Promise：使用Promise，告别回调函数



### 20-async/await：使用同步的方式去写异步代码



## 五、浏览器中的页面

### 21-Chrome开发者工具：利用网络面板做性能分析



### 22-DOM树：JavaScript是如何影响DOM树构建的？



### 23-渲染流水线：CSS如何影响首次加载时的白屏时间？



### 24-分层和合成机制：为什么CSS动画比JavaScript高效？



### 25-页面性能：如何系统地优化页面？



### 26-虚拟DOM：虚拟DOM和实际的DOM有何不同？



### 27-渐进式网页应用（PWA）：它究竟解决了Web应用的哪些问题？



### 28-WebComponent：像搭积木一样构建Web应用



## 六、浏览器中的网络

### 29-HTTP/1：HTTP性能优化



### 30-HTTP/2：如何提升网络速度？



### 31-HTTP/3：甩掉TCP、TLS 的包袱，构建高效网络



## 七、浏览器安全

### 32-同源策略：为什么XMLHttpRequest不能跨域请求资源？



### 33-跨站脚本攻击（XSS）：为什么Cookie中有HttpOnly属性？



### 34-CSRF攻击：陌生链接不要随便点



### 35-安全沙箱：页面和系统之间的隔离墙



### 36-HTTPS：让数据传输更安全





